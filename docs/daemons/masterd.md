# masterd - é—¨æ´¾å¸ˆçˆ¶å®ˆæŠ¤è¿›ç¨‹

## ğŸ“‹ æ¦‚è¿°

masterd æ˜¯ç‚é»„ç¾¤ä¾ ä¼ MUDæ¸¸æˆä¸­ä¸“é—¨å¤„ç†é—¨æ´¾å¸ˆçˆ¶åŠŸèƒ½çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç†NPCå¸ˆçˆ¶å‘ç©å®¶ä¼ æˆæ­¦åŠŸå’Œå‘æ”¾ç‰©å“çš„æ ¸å¿ƒé€»è¾‘ã€‚åŸºäºå®é™…ä»£ç å®ç°ï¼Œç¡®ä¿é—¨æ´¾æŠ€èƒ½çš„åˆç†ä¼ æˆå’Œé—¨æ´¾èµ„æºçš„åˆ†é…ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. æ­¦åŠŸä¼ æˆç®¡ç†
- **é—¨æ´¾æ­¦åŠŸä¼ æˆ** - å¤„ç†é—¨æ´¾å¸ˆçˆ¶å‘å¼Ÿå­ä¼ æˆæ­¦åŠŸçš„å®Œæ•´æµç¨‹
- **ç»æ‹›æŠ€èƒ½æˆäºˆ** - ç®¡ç†æ­¦åŠŸç»æ‹›çš„ä¼ æˆæ¡ä»¶å’Œæ‰§è¡Œ
- **æŠ€èƒ½ç­‰çº§éªŒè¯** - éªŒè¯å¼Ÿå­æ˜¯å¦æ»¡è¶³å­¦ä¹ å„é¡¹æ­¦åŠŸçš„å‰ææ¡ä»¶
- **åŸºç¡€æŠ€èƒ½æå‡** - åœ¨ä¼ æˆä¸»æŠ€èƒ½çš„åŒæ—¶æå‡ç›¸å…³åŸºç¡€æŠ€èƒ½ç­‰çº§

### 2. ç‰©å“å‘æ”¾ç®¡ç†
- **é—¨æ´¾ç‰©å“åˆ†é…** - å¤„ç†å¸ˆçˆ¶å‘å¼Ÿå­å‘æ”¾é—¨æ´¾ç‰¹æœ‰ç‰©å“
- **å¥–åŠ±ç‰©å“ç®¡ç†** - ç®¡ç†å®Œæˆç‰¹å®šæ¡ä»¶åçš„ç‰©å“å¥–åŠ±
- **é—¨æ´¾èµ„æºæ§åˆ¶** - ç¡®ä¿é—¨æ´¾èµ„æºçš„åˆç†åˆ†é…å’Œä½¿ç”¨

### 3. é—¨æ´¾æƒé™æ§åˆ¶
- **é—¨æ´¾å…³ç³»éªŒè¯** - ä¸¥æ ¼éªŒè¯ä¼ æˆè€…å’Œå­¦ä¹ è€…çš„é—¨æ´¾å½’å±
- **è´¡çŒ®å€¼ç®¡ç†** - ç®¡ç†å’ŒéªŒè¯é—¨æ´¾è´¡çŒ®å€¼è¦æ±‚
- **æƒé™ç­‰çº§æ§åˆ¶** - æ ¹æ®é—¨æ´¾åœ°ä½æ§åˆ¶å¯ä¼ æˆçš„æ­¦åŠŸç­‰çº§

### 4. å­¦ä¹ æ¡ä»¶éªŒè¯
- **å¤šç»´åº¦æ¡ä»¶æ£€æŸ¥** - ç»¼åˆæ£€æŸ¥ç¥å€¼ã€è´¡çŒ®å€¼ã€æŠ€èƒ½ç­‰çº§ã€å†…åŠ›ä¿®ä¸ºç­‰
- **å‰ç½®æŠ€èƒ½éªŒè¯** - ç¡®ä¿å¼Ÿå­å…·å¤‡å­¦ä¹ æ‰€éœ€çš„å‰ç½®æŠ€èƒ½
- **ä¿®ä¸ºè¦æ±‚éªŒè¯** - éªŒè¯å†…åŠ›å’Œç²¾åŠ›ä¿®ä¸ºæ˜¯å¦è¾¾æ ‡

## ğŸ’» æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ•°æ®ç»“æ„

```lpc
// æ”¯æŒä¼ æˆçš„åŸºç¡€æŠ€èƒ½ç±»å‹ï¼ˆå¯æ¿€å‘æŠ€èƒ½ï¼‰
string *valid_types = ({
    "force", "dodge", "unarmed", "cuff", "strike", "hand", "finger",
    "claw", "sword", "blade", "staff", "hammer", "club", "whip",
    "dagger", "throwing", "parry", "magic", "medical", "poison",
    "chuixiao-jifa", "tanqin-jifa", "guzheng-jifa", "cooking"
});
```

### ä¸»è¦å‡½æ•°æ¥å£

#### æ­¦åŠŸä¼ æˆå‡½æ•°
```lpc
public mixed teach_pfm(object who, object ob, mapping b)
```
- **å‚æ•°**:
  - `who`: å­¦ä¹ è€…ï¼ˆå¼Ÿå­/ç©å®¶å¯¹è±¡ï¼‰
  - `ob`: ä¼ æˆè€…ï¼ˆå¸ˆçˆ¶/NPCå¯¹è±¡ï¼‰
  - `b`: ä¼ æˆé…ç½®æ˜ å°„ï¼ŒåŒ…å«æ‰€æœ‰æ¡ä»¶å’Œè¦æ±‚
- **è¿”å›å€¼**: æˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²
- **åŠŸèƒ½**: æ‰§è¡Œå®Œæ•´çš„æ­¦åŠŸä¼ æˆé€»è¾‘ï¼ŒåŒ…æ‹¬æ¡ä»¶éªŒè¯å’ŒæŠ€èƒ½æˆäºˆ

#### ç‰©å“å‘æ”¾å‡½æ•°
```lpc
public mixed give_item(object who, object ob, mapping b)
```
- **å‚æ•°**: åŒä¸Š
- **åŠŸèƒ½**: æ‰§è¡Œç‰©å“å‘æ”¾é€»è¾‘ï¼ŒéªŒè¯è·å¾—æ¡ä»¶

## ğŸ”„ å·¥ä½œæµç¨‹

### æ­¦åŠŸä¼ æˆå®Œæ•´æµç¨‹

#### 1. é—¨æ´¾å…³ç³»éªŒè¯é˜¶æ®µ
```lpc
// æ£€æŸ¥æ˜¯å¦ä¸ºåŒé—¨æ´¾ï¼ˆé™¤éè®¾ç½®ä¸ºfreeï¼‰
if (!b["free"] && who->query("family/family_name") != ob->query("family/family_name"))
    return "ä½ å’Œ" + ob->name() + "å¹¶éåŒé—¨ï¼Œçœ‹èµ·æ¥" + ob->name() + "å¹¶ä¸æ‰“ç®—ä¼ æˆä»€ä¹ˆç»™ä½ ã€‚";
```

#### 2. ä¾ ä¹‰æ­£æ°”å€¼æ£€æŸ¥
```lpc
// éªŒè¯ä¾ ä¹‰æ­£æ°”å€¼æ˜¯å¦è¾¾æ ‡
if (b["shen"] && who->query("shen") < b["shen"])
    return "ä½ çš„ä¾ ä¹‰æ­£æ°”å€¼å¤ªä½ï¼Œææ€•éš¾ä»¥é¢†æ‚Ÿå…¶ä¸­ç²¾è¦ã€‚";
```

#### 3. é—¨æ´¾è´¡çŒ®å€¼éªŒè¯
```lpc
// æ£€æŸ¥é—¨æ´¾è´¡çŒ®å€¼æ˜¯å¦è¶³å¤Ÿ
if (b["gongxian"] && who->query("gongxian") < b["gongxian"])
    return "ä½ åœ¨é—¨æ´¾ä¸­çš„è´¡çŒ®å¤ªä½ï¼Œææ€•éš¾ä»¥é¢†æ‚Ÿå…¶ä¸­ç²¾è¦ã€‚";
```

#### 4. å‰ç½®æŠ€èƒ½æ¡ä»¶éªŒè¯
```lpc
// éªŒè¯æœ€å¤š5é¡¹å‰ç½®æŠ€èƒ½åŠå…¶ç­‰çº§
for (i = 1; i <= 5; i++) {
    if (b["sk" + i] && who->query_skill(b["sk" + i], 1) < b["lv" + i])
        return "ä½ çš„" + to_chinese(b["sk" + i]) + "ç«å€™ä¸å¤Ÿï¼Œææ€•éš¾ä»¥é¢†æ‚Ÿå…¶ä¸­ç²¾è¦ã€‚";
}
```

#### 5. å†…åŠŸè½»åŠŸè¦æ±‚æ£€æŸ¥
```lpc
// æ£€æŸ¥åŸºç¡€å†…åŠŸå’Œè½»åŠŸç­‰çº§
if (b["force"] && who->query_skill("force", 1) < b["force"])
    return "ä½ çš„å†…åŠŸä¿®ä¸ºå¤ªå·®ï¼Œææ€•éš¾ä»¥é¢†æ‚Ÿå…¶ä¸­ç²¾è¦ã€‚";

if (b["dodge"] && who->query_skill("dodge", 1) < b["dodge"])
    return "ä½ çš„è½»åŠŸä¿®ä¸ºå¤ªå·®ï¼Œææ€•éš¾ä»¥é¢†æ‚Ÿå…¶ä¸­ç²¾è¦ã€‚";
```

#### 6. å†…åŠ›ç²¾åŠ›ä¿®ä¸ºéªŒè¯
```lpc
// éªŒè¯å†…åŠ›ä¸Šé™æ˜¯å¦è¾¾æ ‡
if (b["neili"] && who->query("max_neili") < b["neili"])
    return "ä½ çš„å†…åŠ›ä¿®ä¸ºå¤ªå·®ï¼Œææ€•éš¾ä»¥é¢†æ‚Ÿå…¶ä¸­ç²¾è¦ã€‚";

// éªŒè¯ç²¾åŠ›ä¸Šé™æ˜¯å¦è¾¾æ ‡
if (b["jingli"] && who->query("max_jingli") < b["jingli"])
    return "ä½ çš„ç²¾åŠ›ä¿®ä¸ºå¤ªå·®ï¼Œææ€•éš¾ä»¥é¢†æ‚Ÿå…¶ä¸­ç²¾è¦ã€‚";
```

#### 7. æ­¦åŠŸä¼ æˆæ‰§è¡Œ
```lpc
// è®¡ç®—æŠ€èƒ½æå‡ç­‰çº§
lvl = who->query_skill(name, 1) / 2 + 1;
if (lvl > 200) lvl = 200;

// æˆäºˆä¸»è¦æ­¦åŠŸæŠ€èƒ½
who->set_skill(name, lvl);

// æå‡ç›¸å…³åŸºç¡€æŠ€èƒ½ï¼ˆå¦‚æœæ˜¯å¯æ¿€å‘ç±»å‹ï¼‰
for (i = 1; i <= 5; i++) {
    if (b["sk" + i] && member_array(b["sk" + i], valid_types) != -1)
        who->set_skill(b["sk" + i], who->query_skill(b["sk" + i], 1) + lvl/2);
}
```

#### 8. é—¨æ´¾è´¡çŒ®å€¼æ‰£é™¤
```lpc
// æ‰£é™¤é—¨æ´¾è´¡çŒ®å€¼ï¼ˆå¦‚æœé…ç½®äº†è¦æ±‚ï¼‰
if (b["gongxian"])
    who->add("gongxian", -b["gongxian"]);
```

## âš™ï¸ é…ç½®å‚æ•°è¯¦è§£

### æ­¦åŠŸä¼ æˆé…ç½®å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…é¡» | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `name` | string | æ˜¯ | æ­¦åŠŸæŠ€èƒ½åç§° | "sword", "force", "dodge" |
| `perform` | string | å¦ | ç»æ‹›åç§°ï¼ˆé¢„ç•™ï¼‰ | "pi", "qiao" |
| `free` | int | å¦ | æ˜¯å¦æ— è§†é—¨æ´¾é™åˆ¶ï¼ˆ1=æ˜¯ï¼‰ | 1 |
| `shen` | int | å¦ | ä¾ ä¹‰æ­£æ°”å€¼æœ€ä½è¦æ±‚ | 10000 |
| `gongxian` | int | å¦ | é—¨æ´¾è´¡çŒ®å€¼è¦æ±‚ | 500 |
| `sk1-sk5` | string | å¦ | å‰ç½®æŠ€èƒ½1-5åç§° | "force", "sword" |
| `lv1-lv5` | int | å¦ | å‰ç½®æŠ€èƒ½1-5æœ€ä½ç­‰çº§ | 100, 120 |
| `force` | int | å¦ | åŸºç¡€å†…åŠŸæœ€ä½ç­‰çº§ | 120 |
| `dodge` | int | å¦ | åŸºç¡€è½»åŠŸæœ€ä½ç­‰çº§ | 120 |
| `neili` | int | å¦ | å†…åŠ›ä¸Šé™æœ€ä½è¦æ±‚ | 1000 |
| `jingli` | int | å¦ | ç²¾åŠ›ä¸Šé™æœ€ä½è¦æ±‚ | 500 |

### æ¶ˆæ¯é…ç½®å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `msg1` | string | ä¼ æˆå¤±è´¥æ—¶æ˜¾ç¤ºçš„æ¶ˆæ¯ |
| `msg2` | string | ä¼ æˆæˆåŠŸæ—¶æ˜¾ç¤ºçš„æ¶ˆæ¯ |
| `temp1-temp3` | string | ä¸´æ—¶æ¶ˆæ¯æ¨¡æ¿å˜é‡ |
| `tmsg1-tmsg3` | string | ä¸´æ—¶æ¶ˆæ¯å†…å®¹ |

## âš ï¸ å¼€å‘æ³¨æ„äº‹é¡¹

### å®‰å…¨æ£€æŸ¥æœºåˆ¶
1. **é—¨æ´¾ä¸¥æ ¼éªŒè¯** - é»˜è®¤æƒ…å†µä¸‹å¿…é¡»åŒé—¨æ´¾æ‰èƒ½ä¼ æˆï¼ˆé™¤éè®¾ç½®free=1ï¼‰
2. **å¤šæ¡ä»¶ç»¼åˆéªŒè¯** - æ‰€æœ‰æ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ï¼Œç¼ºä¸€ä¸å¯
3. **æŠ€èƒ½ç­‰çº§ä¸Šé™æ§åˆ¶** - ä¼ æˆåçš„æŠ€èƒ½ç­‰çº§æœ€é«˜ä¸è¶…è¿‡200çº§
4. **è´¡çŒ®å€¼åŸå­æ“ä½œ** - è´¡çŒ®å€¼æ‰£é™¤å¿…é¡»ç¡®ä¿è¶³å¤Ÿä½™é¢

### æ€§èƒ½è€ƒè™‘
1. **å¾ªç¯æ•ˆç‡** - æŠ€èƒ½éªŒè¯å¾ªç¯æœ€å¤š5æ¬¡ï¼Œé¿å…è¿‡åº¦è®¡ç®—
2. **æ•°ç»„æŸ¥æ‰¾ä¼˜åŒ–** - ä½¿ç”¨member_arrayè¿›è¡ŒæŠ€èƒ½ç±»å‹åˆ¤æ–­
3. **é”™è¯¯æå‰è¿”å›** - ä»»ä½•æ¡ä»¶ä¸æ»¡è¶³ç«‹å³è¿”å›ï¼Œé¿å…æ— æ•ˆè®¡ç®—

### æ‰©å±•æ€§è€ƒè™‘
1. **é…ç½®é©±åŠ¨** - æ‰€æœ‰æ¡ä»¶éƒ½é€šè¿‡é…ç½®å‚æ•°æ§åˆ¶ï¼Œä¾¿äºè°ƒæ•´
2. **æŠ€èƒ½ç±»å‹å¯æ‰©å±•** - valid_typesæ•°ç»„æ˜“äºç»´æŠ¤å’Œæ‰©å±•
3. **æ¶ˆæ¯æ¨¡æ¿åŒ–** - æ”¯æŒè‡ªå®šä¹‰æˆåŠŸå¤±è´¥æ¶ˆæ¯

## ğŸ”§ å®é™…ä½¿ç”¨ç¤ºä¾‹

### æŒé—¨ä¼ æˆé«˜çº§æ­¦åŠŸ
```lpc
// åœ¨é—¨æ´¾æŒé—¨NPCä¸­é…ç½®
void init()
{
    add_action("do_skills", "skills");
}

int do_skills(string arg)
{
    mapping teach;

    // é…ç½®ä¼ æˆæœ¬é—¨é«˜çº§å‰‘æ³•çš„è¦æ±‚
    teach = ([
        "name": "sword",           // ä¼ æˆå‰‘æ³•æŠ€èƒ½
        "shen": 50000,             // éœ€è¦5ä¸‡ä¾ ä¹‰æ­£æ°”å€¼
        "gongxian": 2000,          // éœ€è¦2000é—¨æ´¾è´¡çŒ®
        "sk1": "force",            // å‰ç½®æŠ€èƒ½1ï¼šå†…åŠŸ
        "lv1": 150,                // å†…åŠŸéœ€è¦150çº§
        "sk2": "sword",            // å‰ç½®æŠ€èƒ½2ï¼šå‰‘æ³•
        "lv2": 120,                // åŸºç¡€å‰‘æ³•éœ€è¦120çº§
        "sk3": "dodge",            // å‰ç½®æŠ€èƒ½3ï¼šè½»åŠŸ
        "lv3": 120,                // è½»åŠŸéœ€è¦120çº§
        "force": 150,              // åŸºç¡€å†…åŠŸéœ€è¦150çº§
        "neili": 5000,             // å†…åŠ›ä¸Šé™éœ€è¦5000
        "jingli": 2000,            // ç²¾åŠ›ä¸Šé™éœ€è¦2000
        "msg1": "ä½ çš„ä¿®ä¸ºè¿˜å·®å¾—è¿œï¼Œå›å»å†ç»ƒç»ƒå§ã€‚",
        "msg2": "å¾ˆå¥½ï¼æœ¬é—¨ç»å­¦ä»Šæ—¥ä¼ äºä½ ï¼Œæœ›ä½ å¥½è‡ªä¸ºä¹‹ï¼"
    ]);

    return MASTER_D->teach_pfm(this_player(), this_object(), teach);
}
```

### å¸ˆçˆ¶å‘æ”¾é—¨æ´¾ç‰©å“
```lpc
// åœ¨é—¨æ´¾å¸ˆçˆ¶NPCä¸­é…ç½®
int do_gift(string arg)
{
    mapping gift;

    // é…ç½®å‘æ”¾é—¨æ´¾æœé¥°çš„è¦æ±‚
    gift = ([
        "shen": 10000,             // éœ€è¦1ä¸‡ä¾ ä¹‰æ­£æ°”å€¼
        "gongxian": 500,           // éœ€è¦500é—¨æ´¾è´¡çŒ®
        "sk1": "force",            // å‰ç½®æŠ€èƒ½ï¼šå†…åŠŸ
        "lv1": 80,                 // å†…åŠŸéœ€è¦80çº§
        "force": 80,               // åŸºç¡€å†…åŠŸéœ€è¦80çº§
        "msg1": "ä½ å¯¹æœ¬é—¨çš„è´¡çŒ®è¿˜ä¸å¤Ÿï¼Œç»§ç»­åŠªåŠ›å§ã€‚",
        "msg2": "è¿™æ˜¯æœ¬é—¨ç‰¹åˆ¶æœé¥°ï¼Œä½ æ‹¿å»å§ã€‚"
    ]);

    return MASTER_D->give_item(this_player(), this_object(), gift);
}
```

---
*åŸºäº adm/daemons/masterd.c å®é™…ä»£ç å®ç°*
*ç»´æŠ¤å›¢é˜Ÿï¼šç‚é»„ç¾¤ä¾ ä¼ å¼€å‘ç»„*"file_path"ï¼š"C:\Users\oiuv\home\mud\docs\daemons\masterd.md"